<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Run With 3H - AIë¥¼ í™œìš©í•œ ëŸ¬ë‹ í›ˆë ¨ì¼ì§€ ë° ì»¤ë®¤ë‹ˆí‹°</title>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script>
    // Babel ê²½ê³  ë©”ì‹œì§€ ìˆ¨ê¹€
    console.warn = function() {};
  </script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif; background: #f5f7fa; color: #1a202c; }
    .container { max-width: 480px; margin: 0 auto; background: white; min-height: 100vh; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; color: white; position: relative; min-height: 80px; }
    .header h1 { font-size: 24px; font-weight: 700; margin-bottom: 5px; }
    .header p { font-size: 14px; opacity: 0.9; }
    .header-icons { position: absolute; top: 20px; right: 20px; display: flex; flex-direction: column; gap: 8px; align-items: flex-end; }
    .icon-btn { padding: 8px 16px; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 6px; color: white; font-size: 13px; cursor: pointer; transition: all 0.3s; white-space: nowrap; }
    .icon-btn:hover { background: rgba(255, 255, 255, 0.3); transform: scale(1.05); }
    .auth-container { max-width: 400px; margin: 0 auto; padding: 40px 20px; }
    .auth-logo { text-align: center; margin-bottom: 40px; }
    .auth-logo h1 { font-size: 36px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 8px; }
    .auth-logo p { color: #718096; font-size: 14px; }
    .auth-tabs { display: flex; gap: 8px; margin-bottom: 24px; }
    .auth-tab { flex: 1; padding: 12px; border: none; background: #f7fafc; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; color: #718096; transition: all 0.3s; }
    .auth-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; color: #4a5568; }
    .form-input { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; transition: border 0.3s; }
    .form-input:focus { outline: none; border-color: #667eea; }
    .form-input.error { border-color: #e53e3e; }
    .error-message { color: #e53e3e; font-size: 12px; margin-top: 4px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; width: 100%; }
    .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-secondary { background: #48bb78; color: white; width: 100%; }
    .btn-secondary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4); }
    .btn-download { background: #4299e1; color: white; margin-top: 12px; width: 100%; }
    .text-link { color: #667eea; cursor: pointer; font-size: 13px; margin-top: 12px; display: inline-block; }
    .text-link:hover { text-decoration: underline; }
    .admin-panel { background: #fff5e6; border: 2px solid #ed8936; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
    .user-table { width: 100%; border-collapse: collapse; margin-top: 16px; font-size: 13px; }
    .user-table th, .user-table td { padding: 8px; text-align: left; border-bottom: 1px solid #e2e8f0; }
    .user-table th { background: #f7fafc; font-weight: 600; color: #4a5568; }
    .nav-bar { display: flex; background: white; border-bottom: 1px solid #e2e8f0; position: sticky; top: 0; z-index: 100; }
    .nav-item { flex: 1; padding: 16px; text-align: center; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; font-size: 14px; font-weight: 500; color: #718096; }
    .nav-item.active { color: #667eea; border-bottom-color: #667eea; }
    .page-content { padding: 20px; padding-bottom: 80px; }
    .section { background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .section-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #2d3748; }
    .progress-bar { height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; margin-bottom: 8px; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); transition: width 0.3s; }
    .progress-text { font-size: 12px; color: #718096; text-align: right; }
    .record-input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
    .record-input-item { text-align: center; }
    .record-input-item label { display: block; font-size: 12px; color: #718096; margin-bottom: 4px; }
    .record-input-item input { width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; text-align: center; }
    .info-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e2e8f0; }
    .info-row:last-child { border-bottom: none; }
    .info-label { font-size: 14px; color: #718096; }
    .info-value { font-size: 14px; font-weight: 600; color: #2d3748; }
    .summary-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
    .summary-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
    .summary-subtitle { font-size: 14px; opacity: 0.9; }
    .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 16px; }
    .stat-card { background: #f7fafc; padding: 16px; border-radius: 8px; text-align: center; }
    .stat-value { font-size: 24px; font-weight: 700; color: #667eea; margin-bottom: 4px; }
    .stat-label { font-size: 12px; color: #718096; }
    .feed-card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .feed-header { display: flex; align-items: center; margin-bottom: 12px; }
    .feed-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; margin-right: 12px; }
    .feed-user-info { flex: 1; }
    .feed-username { font-weight: 600; font-size: 14px; color: #2d3748; }
    .feed-time { font-size: 12px; color: #a0aec0; }
    .feed-image { width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; margin-bottom: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
    .feed-stat { font-size: 32px; font-weight: 700; z-index: 1; }
    .feed-stat-label { font-size: 14px; opacity: 0.9; z-index: 1; }
    .feed-content { font-size: 14px; line-height: 1.6; color: #4a5568; margin-bottom: 12px; }
    .tag { display: inline-block; padding: 4px 12px; background: #edf2f7; color: #667eea; border-radius: 12px; font-size: 12px; font-weight: 500; margin-right: 8px; margin-top: 8px; }
    .feed-stats { display: flex; gap: 16px; padding: 12px 0; border-top: 1px solid #e2e8f0; font-size: 13px; color: #718096; }
    .empty-state { text-align: center; padding: 40px 20px; color: #a0aec0; }
    .empty-icon { font-size: 48px; margin-bottom: 12px; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    const getStorage = (key, def) => {
      try { return JSON.parse(localStorage.getItem(key)) || def; } catch { return def; }
    };
    const setStorage = (key, val) => localStorage.setItem(key, JSON.stringify(val));

    function App() {
      const [user, setUser] = useState(() => getStorage('currentUser', null));
      const [isLoggedIn, setIsLoggedIn] = useState(() => getStorage('isLoggedIn', false));

      const logout = () => {
        setUser(null);
        setIsLoggedIn(false);
        setStorage('isLoggedIn', false);
        setStorage('currentUser', null);
      };

      if (!isLoggedIn) return <AuthPage setUser={setUser} setIsLoggedIn={setIsLoggedIn} />;
      return <MainApp user={user} logout={logout} />;
    }

    function AuthPage({ setUser, setIsLoggedIn }) {
      const [mode, setMode] = useState('login');
      const [loginData, setLoginData] = useState({ userId: '', password: '' });
      const [signupData, setSignupData] = useState({
        name: '', phone: '', email: '', userId: '', password: '', passwordConfirm: '', birthDate: ''
      });
      const [errors, setErrors] = useState({});
      const [emailVerified, setEmailVerified] = useState(false);
      const [verificationCode, setVerificationCode] = useState('');
      const [codeSent, setCodeSent] = useState(false);
      const [sendingCode, setSendingCode] = useState(false);
      const [verifyingCode, setVerifyingCode] = useState(false);

      const API_URL = window.location.origin; // ë™ì¼ ì„œë²„ì—ì„œ API í˜¸ì¶œ
      const USE_LOCAL_MODE = false; // ì‹¤ì œ ì´ë©”ì¼ ë°œì†¡ ëª¨ë“œ

      const sendVerificationCode = async () => {
        if (!signupData.email) {
          setErrors({...errors, email: 'ì´ë©”ì¼ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”'});
          return;
        }
        if (!/\S+@\S+\.\S+/.test(signupData.email)) {
          setErrors({...errors, email: 'ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'});
          return;
        }

        setSendingCode(true);

        // ë¡œì»¬ í…ŒìŠ¤íŠ¸ ëª¨ë“œ
        if (USE_LOCAL_MODE) {
          setTimeout(() => {
            const mockCode = Math.floor(100000 + Math.random() * 900000).toString();
            console.log('========================================');
            console.log('ğŸ“§ ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ (í…ŒìŠ¤íŠ¸ ëª¨ë“œ)');
            console.log('ì´ë©”ì¼:', signupData.email);
            console.log('ì¸ì¦ ì½”ë“œ:', mockCode);
            console.log('========================================');
            
            // í…ŒìŠ¤íŠ¸ìš© ì½”ë“œ ì €ì¥
            setStorage('testVerificationCode', { email: signupData.email, code: mockCode });
            
            setCodeSent(true);
            setSendingCode(false);
            alert(`ì¸ì¦ ì½”ë“œê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.\n\ní…ŒìŠ¤íŠ¸ ëª¨ë“œ: ì½˜ì†”(F12)ì—ì„œ ì¸ì¦ ì½”ë“œë¥¼ í™•ì¸í•˜ì„¸ìš”.\n\nì¸ì¦ ì½”ë“œ: ${mockCode}`);
          }, 1000);
          return;
        }

        // ì‹¤ì œ ë°±ì—”ë“œ ëª¨ë“œ
        try {
          const response = await fetch(`${API_URL}/api/send-verification`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: signupData.email })
          });
          const data = await response.json();
          
          if (response.ok) {
            setCodeSent(true);
            alert('ì¸ì¦ ì½”ë“œê°€ ì´ë©”ì¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ë©”ì¼í•¨ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
          } else {
            alert(data.error || 'ì¸ì¦ ì½”ë“œ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
          }
        } catch (error) {
          console.error('ë°±ì—”ë“œ ì—°ê²° ì—ëŸ¬:', error);
          alert('ë°±ì—”ë“œ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\ní•´ê²° ë°©ë²•:\n1. backend í´ë”ì—ì„œ "npm install" ì‹¤í–‰\n2. "npm start"ë¡œ ì„œë²„ ì‹¤í–‰\n3. http://localhost:3000/health ì ‘ì† í™•ì¸\n\në˜ëŠ” HTML íŒŒì¼ì—ì„œ USE_LOCAL_MODE = trueë¡œ ì„¤ì •í•˜ì—¬ í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì‚¬ìš©');
        }
        setSendingCode(false);
      };

      const verifyEmailCode = async () => {
        if (!verificationCode) {
          alert('ì¸ì¦ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
          return;
        }

        setVerifyingCode(true);

        // ë¡œì»¬ í…ŒìŠ¤íŠ¸ ëª¨ë“œ
        if (USE_LOCAL_MODE) {
          setTimeout(() => {
            const stored = getStorage('testVerificationCode', null);
            if (stored && stored.email === signupData.email && stored.code === verificationCode) {
              setEmailVerified(true);
              alert('ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! âœ…');
            } else {
              alert('ì¸ì¦ ì½”ë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
            }
            setVerifyingCode(false);
          }, 500);
          return;
        }

        // ì‹¤ì œ ë°±ì—”ë“œ ëª¨ë“œ
        try {
          const response = await fetch(`${API_URL}/api/verify-code`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: signupData.email, code: verificationCode })
          });
          const data = await response.json();
          
          if (response.ok) {
            setEmailVerified(true);
            alert('ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! âœ…');
          } else {
            alert(data.error || 'ì¸ì¦ ì½”ë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
          }
        } catch (error) {
          alert('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
          console.error(error);
        }
        setVerifyingCode(false);
      };

      const validateSignup = () => {
        const err = {};
        if (!signupData.name.trim()) err.name = 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
        if (!signupData.phone.trim()) err.phone = 'ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”';
        if (!signupData.email.trim()) err.email = 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
        else if (!/\S+@\S+\.\S+/.test(signupData.email)) err.email = 'ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
        if (!emailVerified) err.email = 'ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”';
        if (!signupData.userId.trim()) err.userId = 'ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”';
        if (!signupData.password) err.password = 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”';
        else if (signupData.password.length < 6) err.password = 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤';
        if (signupData.password !== signupData.passwordConfirm) err.passwordConfirm = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤';
        if (!signupData.birthDate) err.birthDate = 'ìƒë…„ì›”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
        setErrors(err);
        return Object.keys(err).length === 0;
      };

      const handleSignup = () => {
        if (!validateSignup()) return;
        const users = getStorage('users', []);
        if (users.find(u => u.userId === signupData.userId)) {
          setErrors({ userId: 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤' });
          return;
        }
        if (users.find(u => u.email === signupData.email)) {
          setErrors({ email: 'ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤' });
          return;
        }
        const newUser = { id: Date.now(), ...signupData, createdAt: new Date().toISOString() };
        delete newUser.passwordConfirm;
        users.push(newUser);
        setStorage('users', users);
        alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        setMode('login');
        setSignupData({ name: '', phone: '', email: '', userId: '', password: '', passwordConfirm: '', birthDate: '' });
        setErrors({});
        setEmailVerified(false);
        setCodeSent(false);
        setVerificationCode('');
      };

      const handleLogin = () => {
        const users = getStorage('users', []);
        
        if (users.length === 0) {
          alert('íšŒì›ê°€ì…ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € íšŒì›ê°€ì…ì„ í•´ì£¼ì„¸ìš”.');
          setMode('signup');
          return;
        }
        
        const user = users.find(u => u.userId === loginData.userId && u.password === loginData.password);
        if (user) {
          alert('ë¡œê·¸ì¸ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.');
          setUser(user);
          setIsLoggedIn(true);
          setStorage('isLoggedIn', true);
          setStorage('currentUser', user);
        } else {
          alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤');
        }
      };

      if (mode === 'admin') return <AdminPanel onBack={() => setMode('login')} />;

      return (
        <div className="auth-container">
          <div className="auth-logo">
            <h1>ğŸƒ Run With 3H</h1>
            <p>AIë¥¼ í™œìš©í•œ ëŸ¬ë‹ í›ˆë ¨ì¼ì§€ ë° ì»¤ë®¤ë‹ˆí‹°</p>
          </div>
          <div className="auth-tabs">
            <button className={`auth-tab ${mode === 'login' ? 'active' : ''}`} onClick={() => setMode('login')}>ë¡œê·¸ì¸</button>
            <button className={`auth-tab ${mode === 'signup' ? 'active' : ''}`} onClick={() => setMode('signup')}>íšŒì›ê°€ì…</button>
          </div>

          {mode === 'login' ? (
            <div>
              <div className="form-group">
                <label className="form-label">ì•„ì´ë””</label>
                <input className="form-input" value={loginData.userId} onChange={(e) => setLoginData({...loginData, userId: e.target.value})} onKeyPress={(e) => e.key === 'Enter' && handleLogin()} />
              </div>
              <div className="form-group">
                <label className="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" className="form-input" value={loginData.password} onChange={(e) => setLoginData({...loginData, password: e.target.value})} onKeyPress={(e) => e.key === 'Enter' && handleLogin()} />
              </div>
              <button className="btn btn-primary" onClick={handleLogin}>ë¡œê·¸ì¸</button>
              <a className="text-link" onClick={() => setMode('admin')}>ê´€ë¦¬ì í˜ì´ì§€</a>
            </div>
          ) : (
            <div>
              <div className="form-group">
                <label className="form-label">ì´ë¦„</label>
                <input className={`form-input ${errors.name ? 'error' : ''}`} value={signupData.name} onChange={(e) => setSignupData({...signupData, name: e.target.value})} />
                {errors.name && <div className="error-message">{errors.name}</div>}
              </div>
              <div className="form-group">
                <label className="form-label">ì—°ë½ì²˜</label>
                <input type="tel" className={`form-input ${errors.phone ? 'error' : ''}`} placeholder="010-0000-0000" value={signupData.phone} onChange={(e) => setSignupData({...signupData, phone: e.target.value})} />
                {errors.phone && <div className="error-message">{errors.phone}</div>}
              </div>
              <div className="form-group">
                <label className="form-label">ì´ë©”ì¼ì£¼ì†Œ {emailVerified && <span style={{color: '#48bb78', fontSize: '12px'}}>âœ“ ì¸ì¦ì™„ë£Œ</span>}</label>
                <div style={{display: 'flex', gap: '8px'}}>
                  <input type="email" className={`form-input ${errors.email ? 'error' : ''}`} placeholder="example@email.com" value={signupData.email} onChange={(e) => { setSignupData({...signupData, email: e.target.value}); setEmailVerified(false); setCodeSent(false); }} disabled={emailVerified} style={{flex: 1}} />
                  <button className="btn btn-secondary" onClick={sendVerificationCode} disabled={sendingCode || emailVerified} style={{width: 'auto', padding: '12px 16px', whiteSpace: 'nowrap'}}>
                    {sendingCode ? 'ë°œì†¡ ì¤‘...' : emailVerified ? 'ì¸ì¦ì™„ë£Œ' : 'ì¸ì¦ì½”ë“œ ë°œì†¡'}
                  </button>
                </div>
                {errors.email && <div className="error-message">{errors.email}</div>}
              </div>
              {codeSent && !emailVerified && (
                <div className="form-group">
                  <label className="form-label">ì¸ì¦ ì½”ë“œ (ì´ë©”ì¼ í™•ì¸)</label>
                  <div style={{display: 'flex', gap: '8px'}}>
                    <input className="form-input" placeholder="6ìë¦¬ ì½”ë“œ ì…ë ¥" value={verificationCode} onChange={(e) => setVerificationCode(e.target.value)} maxLength="6" style={{flex: 1}} />
                    <button className="btn btn-secondary" onClick={verifyEmailCode} disabled={verifyingCode} style={{width: 'auto', padding: '12px 16px', whiteSpace: 'nowrap'}}>
                      {verifyingCode ? 'í™•ì¸ ì¤‘...' : 'í™•ì¸'}
                    </button>
                  </div>
                  <div style={{fontSize: '12px', color: '#718096', marginTop: '4px'}}>10ë¶„ ì´ë‚´ì— ì…ë ¥í•´ì£¼ì„¸ìš”</div>
                </div>
              )}
              <div className="form-group">
                <label className="form-label">ì•„ì´ë””</label>
                <input className={`form-input ${errors.userId ? 'error' : ''}`} value={signupData.userId} onChange={(e) => setSignupData({...signupData, userId: e.target.value})} />
                {errors.userId && <div className="error-message">{errors.userId}</div>}
              </div>
              <div className="form-group">
                <label className="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" className={`form-input ${errors.password ? 'error' : ''}`} value={signupData.password} onChange={(e) => setSignupData({...signupData, password: e.target.value})} />
                {errors.password && <div className="error-message">{errors.password}</div>}
              </div>
              <div className="form-group">
                <label className="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                <input type="password" className={`form-input ${errors.passwordConfirm ? 'error' : ''}`} value={signupData.passwordConfirm} onChange={(e) => setSignupData({...signupData, passwordConfirm: e.target.value})} />
                {errors.passwordConfirm && <div className="error-message">{errors.passwordConfirm}</div>}
              </div>
              <div className="form-group">
                <label className="form-label">ìƒë…„ì›”ì¼</label>
                <input type="date" className={`form-input ${errors.birthDate ? 'error' : ''}`} value={signupData.birthDate} onChange={(e) => setSignupData({...signupData, birthDate: e.target.value})} />
                {errors.birthDate && <div className="error-message">{errors.birthDate}</div>}
              </div>
              <button className="btn btn-primary" onClick={handleSignup}>íšŒì›ê°€ì…</button>
            </div>
          )}
        </div>
      );
    }

    function AdminPanel({ onBack }) {
      const users = getStorage('users', []);

      const downloadCSV = () => {
        const headers = ['ID', 'ì´ë¦„', 'ì—°ë½ì²˜', 'ì´ë©”ì¼', 'ì•„ì´ë””', 'ìƒë…„ì›”ì¼', 'ê°€ì…ì¼'];
        const rows = users.map(u => [u.id, u.name, u.phone, u.email, u.userId, u.birthDate, new Date(u.createdAt).toLocaleString('ko-KR')]);
        const csv = [headers.join(','), ...rows.map(r => r.map(c => `"${c}"`).join(','))].join('\n');
        const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `íšŒì›ë°ì´í„°_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
      };

      return (
        <div className="auth-container">
          <div className="admin-panel">
            <div style={{fontSize: '18px', fontWeight: '600', marginBottom: '12px', color: '#ed8936'}}>ğŸ‘¨â€ğŸ’¼ ê´€ë¦¬ì í˜ì´ì§€</div>
            <p style={{fontSize: '14px', color: '#718096', marginBottom: '12px'}}>ì´ {users.length}ëª…ì˜ íšŒì›ì´ ê°€ì…ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
            <button className="btn btn-download" onClick={downloadCSV}>ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ</button>
          </div>
          {users.length > 0 && (
            <div className="section">
              <h3 className="section-title">íšŒì› ëª©ë¡</h3>
              <div style={{overflowX: 'auto'}}>
                <table className="user-table">
                  <thead><tr><th>ì´ë¦„</th><th>ì•„ì´ë””</th><th>ì´ë©”ì¼</th><th>ê°€ì…ì¼</th></tr></thead>
                  <tbody>{users.map(u => <tr key={u.id}><td>{u.name}</td><td>{u.userId}</td><td>{u.email}</td><td>{new Date(u.createdAt).toLocaleDateString('ko-KR')}</td></tr>)}</tbody>
                </table>
              </div>
            </div>
          )}
          <a className="text-link" onClick={onBack}>â† ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
      );
    }

    function MainApp({ user, logout }) {
      const [page, setPage] = useState('profile');
      const [showAccountInfo, setShowAccountInfo] = useState(false);

      if (showAccountInfo) return <AccountInfoPage user={user} onBack={() => setShowAccountInfo(false)} />;

      return (
        <div className="container">
          <div className="header">
            <h1>ğŸƒ Run With 3H</h1>
            <p>AIë¥¼ í™œìš©í•œ ëŸ¬ë‹ í›ˆë ¨ì¼ì§€ ë° ì»¤ë®¤ë‹ˆí‹°</p>
            <div className="header-icons">
              <button className="icon-btn" onClick={() => setShowAccountInfo(true)}>ğŸ‘¤ ë‚´ í”„ë¡œí•„</button>
              <button className="icon-btn" onClick={logout}>ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
            </div>
          </div>
          <div className="nav-bar">
            <div className={`nav-item ${page === 'profile' ? 'active' : ''}`} onClick={() => setPage('profile')}>í”„ë¡œí•„</div>
            <div className={`nav-item ${page === 'training' ? 'active' : ''}`} onClick={() => setPage('training')}>í›ˆë ¨</div>
            <div className={`nav-item ${page === 'community' ? 'active' : ''}`} onClick={() => setPage('community')}>ì»¤ë®¤ë‹ˆí‹°</div>
          </div>
          <div className="page-content">
            {page === 'profile' && <ProfilePage userId={user.id} />}
            {page === 'training' && <TrainingPage userId={user.id} />}
            {page === 'community' && <CommunityPage userId={user.id} />}
          </div>
        </div>
      );
    }

    function AccountInfoPage({ user, onBack }) {
      const [selectedMonth, setSelectedMonth] = useState(new Date());
      const [selectedDate, setSelectedDate] = useState(null);
      const workouts = getStorage(`workouts_${user.id}`, []);

      const changeMonth = (delta) => {
        const newMonth = new Date(selectedMonth);
        newMonth.setMonth(newMonth.getMonth() + delta);
        setSelectedMonth(newMonth);
        setSelectedDate(null);
      };

      const getDaysInMonth = () => {
        const year = selectedMonth.getFullYear();
        const month = selectedMonth.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        const days = [];
        for (let i = 0; i < firstDay; i++) {
          days.push(null);
        }
        for (let i = 1; i <= daysInMonth; i++) {
          days.push(i);
        }
        return days;
      };

      const hasWorkout = (day) => {
        if (!day) return false;
        const dateStr = `${selectedMonth.getFullYear()}-${String(selectedMonth.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        return workouts.find(log => log.date === dateStr);
      };

      const selectedWorkout = selectedDate ? hasWorkout(selectedDate) : null;

      return (
        <div className="container">
          <div className="header">
            <h1>ğŸ‘¤ ë‚´ í”„ë¡œí•„</h1>
            <p>ê³„ì • ì •ë³´</p>
          </div>
          <div className="page-content">
            <div className="summary-card">
              <div className="summary-title">{user.name}ë‹˜ì˜ ê³„ì •</div>
              <div className="summary-subtitle">Run With 3H íšŒì›</div>
            </div>
            <div className="section">
              <h2 className="section-title">ğŸ“‹ íšŒì› ì •ë³´</h2>
              <div className="info-row">
                <div className="info-label">ì´ë¦„</div>
                <div className="info-value">{user.name}</div>
              </div>
              <div className="info-row">
                <div className="info-label">ì•„ì´ë””</div>
                <div className="info-value">{user.userId}</div>
              </div>
              <div className="info-row">
                <div className="info-label">ì´ë©”ì¼</div>
                <div className="info-value">{user.email}</div>
              </div>
              <div className="info-row">
                <div className="info-label">ì—°ë½ì²˜</div>
                <div className="info-value">{user.phone}</div>
              </div>
              <div className="info-row">
                <div className="info-label">ìƒë…„ì›”ì¼</div>
                <div className="info-value">{user.birthDate}</div>
              </div>
              <div className="info-row">
                <div className="info-label">ê°€ì…ì¼</div>
                <div className="info-value">{new Date(user.createdAt).toLocaleDateString('ko-KR')}</div>
              </div>
            </div>

            <div className="section">
              <h2 className="section-title">ğŸ“… í›ˆë ¨ ìº˜ë¦°ë”</h2>
              <div style={{marginTop: '20px'}}>
                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px'}}>
                  <div style={{fontSize: '16px', fontWeight: '600', color: '#2d3748'}}>
                    {selectedMonth.getFullYear()}ë…„ {selectedMonth.getMonth() + 1}ì›”
                  </div>
                  <div style={{display: 'flex', gap: '8px'}}>
                    <button style={{padding: '4px 12px', background: '#edf2f7', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '14px', color: '#4a5568'}} onClick={() => changeMonth(-1)}>â—€</button>
                    <button style={{padding: '4px 12px', background: '#edf2f7', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '14px', color: '#4a5568'}} onClick={() => changeMonth(1)}>â–¶</button>
                  </div>
                </div>

                <div style={{display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px'}}>
                  {['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '].map(day => (
                    <div key={day} style={{textAlign: 'center', fontSize: '12px', fontWeight: '600', color: '#718096', padding: '8px 4px'}}>{day}</div>
                  ))}
                  {getDaysInMonth().map((day, index) => {
                    const workout = hasWorkout(day);
                    return (
                      <div 
                        key={index} 
                        style={{
                          aspectRatio: '1',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          borderRadius: '8px',
                          background: !day ? 'transparent' : workout ? '#48bb78' : '#f7fafc',
                          fontSize: '14px',
                          cursor: day ? 'pointer' : 'default',
                          transition: 'all 0.3s',
                          color: workout ? 'white' : '#2d3748',
                          fontWeight: workout ? '600' : 'normal',
                          border: selectedDate === day ? '2px solid #667eea' : '2px solid transparent'
                        }}
                        onClick={() => day && setSelectedDate(day)}
                        onMouseEnter={(e) => day && !workout && (e.target.style.background = '#edf2f7')}
                        onMouseLeave={(e) => day && !workout && (e.target.style.background = '#f7fafc')}
                      >
                        {day}
                      </div>
                    );
                  })}
                </div>

                {selectedWorkout && (
                  <div style={{background: 'white', borderRadius: '12px', padding: '20px', marginTop: '16px', boxShadow: '0 4px 12px rgba(0,0,0,0.15)'}}>
                    <div style={{textAlign: 'right', marginBottom: '12px'}}>
                      <button style={{background: 'none', border: 'none', fontSize: '24px', cursor: 'pointer', color: '#718096'}} onClick={() => setSelectedDate(null)}>Ã—</button>
                    </div>
                    <h3 style={{fontSize: '16px', fontWeight: '600', marginBottom: '12px'}}>
                      {selectedMonth.getMonth() + 1}ì›” {selectedDate}ì¼ í›ˆë ¨
                    </h3>
                    <div className="info-row">
                      <div className="info-label">ìš´ë™ ìœ í˜•</div>
                      <div className="info-value">{selectedWorkout.workout.type}</div>
                    </div>
                    <div className="info-row">
                      <div className="info-label">ê±°ë¦¬</div>
                      <div className="info-value">{selectedWorkout.distance}km</div>
                    </div>
                    <div className="info-row">
                      <div className="info-label">ì‹œê°„</div>
                      <div className="info-value">{selectedWorkout.time}ë¶„</div>
                    </div>
                    {selectedWorkout.avgHr && (
                      <div className="info-row">
                        <div className="info-label">í‰ê·  ì‹¬ë°•ìˆ˜</div>
                        <div className="info-value">{selectedWorkout.avgHr}bpm</div>
                      </div>
                    )}
                    {selectedWorkout.avgCadence && (
                      <div className="info-row">
                        <div className="info-label">í‰ê·  ì¼€ì´ë˜ìŠ¤</div>
                        <div className="info-value">{selectedWorkout.avgCadence}spm</div>
                      </div>
                    )}
                    <div className="info-row">
                      <div className="info-label">ì²´ê° ë‚œì´ë„</div>
                      <div className="info-value">{"â­".repeat(Math.ceil(selectedWorkout.rpe / 2))}</div>
                    </div>
                    <div className="info-row">
                      <div className="info-label">ë‹¬ì„±ë¥ </div>
                      <div className="info-value" style={{color: selectedWorkout.achievement >= 80 ? '#48bb78' : '#ed8936'}}>
                        {selectedWorkout.achievement}%
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>

            <div className="section">
              <button className="btn btn-primary" onClick={onBack}>â† ëŒì•„ê°€ê¸°</button>
            </div>
          </div>
        </div>
      );
    }

    function ProfilePage({ userId }) {
      const [profile, setProfile] = useState(() => getStorage(`profile_${userId}`, { age: '', height: '', weight: '', weeklyRuns: 4 }));
      const [records, setRecords] = useState(() => getStorage(`records_${userId}`, { '5k': { minutes: '', seconds: '' }, '10k': { minutes: '', seconds: '' } }));
      const [goal, setGoal] = useState(() => getStorage(`goal_${userId}`, { eventType: '10k', targetMinutes: '', targetSeconds: '', targetDate: '' }));
      const [profileSaved, setProfileSaved] = useState(() => getStorage(`profileSaved_${userId}`, false));

      const calculateProgress = () => {
        let filled = 0;
        if (profile.age) filled++;
        if (profile.height) filled++;
        if (profile.weight) filled++;
        if (records['5k'].minutes || records['10k'].minutes) filled++;
        if (goal.eventType) filled++;
        if (goal.targetMinutes) filled++;
        if (goal.targetDate) filled++;
        return Math.round((filled / 7) * 100);
      };

      const save = () => {
        setStorage(`profile_${userId}`, profile);
        setStorage(`records_${userId}`, records);
        setStorage(`goal_${userId}`, goal);
        setStorage(`profileSaved_${userId}`, true);
        setProfileSaved(true);
        alert('í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
      };

      const progress = calculateProgress();

      return (
        <>
          <div className="section">
            <div className="progress-bar">
              <div className="progress-fill" style={{width: `${progress}%`}}></div>
            </div>
            <div className="progress-text">ì…ë ¥ ì§„í–‰ë¥ : {progress}%</div>
          </div>

          <div className="section">
            <h2 className="section-title">ğŸ“Š ì‹ ì²´ ì •ë³´</h2>
            <div className="form-row">
              <div className="form-group">
                <label className="form-label">ë‚˜ì´</label>
                <input type="number" className="form-input" placeholder="25" value={profile.age} onChange={(e) => setProfile({...profile, age: e.target.value})} />
              </div>
              <div className="form-group">
                <label className="form-label">ì£¼ê°„ í›ˆë ¨</label>
                <select className="form-input" value={profile.weeklyRuns} onChange={(e) => setProfile({...profile, weeklyRuns: e.target.value})}>
                  <option value="3">ì£¼ 3íšŒ</option>
                  <option value="4">ì£¼ 4íšŒ</option>
                  <option value="5">ì£¼ 5íšŒ</option>
                  <option value="6">ì£¼ 6íšŒ</option>
                </select>
              </div>
            </div>
            <div className="form-row">
              <div className="form-group">
                <label className="form-label">í‚¤ (cm)</label>
                <input type="number" className="form-input" placeholder="170" value={profile.height} onChange={(e) => setProfile({...profile, height: e.target.value})} />
              </div>
              <div className="form-group">
                <label className="form-label">ëª¸ë¬´ê²Œ (kg)</label>
                <input type="number" className="form-input" placeholder="65" value={profile.weight} onChange={(e) => setProfile({...profile, weight: e.target.value})} />
              </div>
            </div>
          </div>

          <div className="section">
            <h2 className="section-title">â±ï¸ í˜„ì¬ ê¸°ë¡</h2>
            <div className="form-group">
              <label className="form-label">5K ê¸°ë¡</label>
              <div className="record-input-grid">
                <div className="record-input-item">
                  <label>ë¶„</label>
                  <input type="number" placeholder="25" value={records['5k'].minutes} onChange={(e) => setRecords({...records, '5k': {...records['5k'], minutes: e.target.value}})} />
                </div>
                <div className="record-input-item">
                  <label>ì´ˆ</label>
                  <input type="number" placeholder="30" value={records['5k'].seconds} onChange={(e) => setRecords({...records, '5k': {...records['5k'], seconds: e.target.value}})} />
                </div>
              </div>
            </div>
            <div className="form-group">
              <label className="form-label">10K ê¸°ë¡</label>
              <div className="record-input-grid">
                <div className="record-input-item">
                  <label>ë¶„</label>
                  <input type="number" placeholder="52" value={records['10k'].minutes} onChange={(e) => setRecords({...records, '10k': {...records['10k'], minutes: e.target.value}})} />
                </div>
                <div className="record-input-item">
                  <label>ì´ˆ</label>
                  <input type="number" placeholder="00" value={records['10k'].seconds} onChange={(e) => setRecords({...records, '10k': {...records['10k'], seconds: e.target.value}})} />
                </div>
              </div>
            </div>
          </div>

          <div className="section">
            <h2 className="section-title">ğŸ¯ ëª©í‘œ ì„¤ì •</h2>
            <div className="form-group">
              <label className="form-label">ëª©í‘œ ì¢…ëª©</label>
              <select className="form-input" value={goal.eventType} onChange={(e) => setGoal({...goal, eventType: e.target.value})}>
                <option value="5k">5K</option>
                <option value="10k">10K</option>
                <option value="half">í•˜í”„ ë§ˆë¼í†¤</option>
                <option value="full">í’€ ë§ˆë¼í†¤</option>
              </select>
            </div>
            <div className="form-group">
              <label className="form-label">ëª©í‘œ ê¸°ë¡</label>
              <div className="record-input-grid">
                <div className="record-input-item">
                  <label>ë¶„</label>
                  <input type="number" placeholder="50" value={goal.targetMinutes} onChange={(e) => setGoal({...goal, targetMinutes: e.target.value})} />
                </div>
                <div className="record-input-item">
                  <label>ì´ˆ</label>
                  <input type="number" placeholder="00" value={goal.targetSeconds} onChange={(e) => setGoal({...goal, targetSeconds: e.target.value})} />
                </div>
              </div>
            </div>
            <div className="form-group">
              <label className="form-label">ëª©í‘œ ë‚ ì§œ</label>
              <input type="date" className="form-input" value={goal.targetDate} onChange={(e) => setGoal({...goal, targetDate: e.target.value})} />
            </div>
          </div>

          <div className="section">
            <button className="btn btn-primary" onClick={save} disabled={progress < 100}>
              {profileSaved ? 'ì €ì¥ë¨ âœ“' : `ì €ì¥ ${progress < 100 ? `(${progress}%)` : ''}`}
            </button>
          </div>
        </>
      );
    }

    function TrainingPage({ userId }) {
      const [viewMode, setViewMode] = useState('week');
      const [currentPeriod, setCurrentPeriod] = useState(new Date());
      const [selectedDay, setSelectedDay] = useState(0);
      const [workouts, setWorkouts] = useState(() => getStorage(`workouts_${userId}`, []));
      const [workoutInput, setWorkoutInput] = useState({ time: '', distance: '', avgHr: '', avgCadence: '', rpe: 5 });
      const [originalWorkoutInput, setOriginalWorkoutInput] = useState(null);

      const today = new Date();
      const threeYearsAgo = new Date(today.getFullYear() - 3, today.getMonth(), today.getDate());
      const threeYearsLater = new Date(today.getFullYear() + 3, today.getMonth(), today.getDate());

      // ì¶”ì²œ ìš´ë™ ëª©ë¡
      const recommendedWorkouts = [
        {
          type: 'Easy Run',
          distance: '5',
          duration: '30ë¶„',
          pace: '6:00 /km',
          description: 'í¸ì•ˆí•œ í˜ì´ìŠ¤ë¡œ ë‹¬ë¦¬ê¸°. ëŒ€í™”ê°€ ê°€ëŠ¥í•œ ê°•ë„',
          tips: 'ì²˜ìŒì´ë¼ë©´ ê±·ê¸°ì™€ ì¡°ê¹…ì„ ë²ˆê°ˆì•„ê°€ë©° ì§„í–‰í•˜ì„¸ìš”'
        },
        {
          type: 'Interval Training',
          distance: '6',
          duration: '40ë¶„',
          pace: '5:00 /km',
          description: 'ë¹ ë¥´ê²Œ-ì²œì²œíˆ ë°˜ë³µ í›ˆë ¨',
          tips: 'ë¹ ë¥¸ êµ¬ê°„ì—ì„œëŠ” 80% ì •ë„ì˜ í˜ìœ¼ë¡œ ë‹¬ë¦¬ì„¸ìš”'
        },
        {
          type: 'Tempo Run',
          distance: '8',
          duration: '45ë¶„',
          pace: '5:30 /km',
          description: 'ì•½ê°„ í˜ë“  ì†ë„ë¡œ ì¼ì •í•˜ê²Œ ë‹¬ë¦¬ê¸°',
          tips: '"ì ë‹¹íˆ í˜ë“¤ë‹¤"ëŠ” ëŠë‚Œì´ ë“¤ì–´ì•¼ í•©ë‹ˆë‹¤'
        },
        {
          type: 'Long Run',
          distance: '10',
          duration: '65ë¶„',
          pace: '6:30 /km',
          description: 'ê¸´ ê±°ë¦¬ ì²œì²œíˆ ë‹¬ë¦¬ê¸°',
          tips: 'ëª©í‘œëŠ” ê±°ë¦¬ê°€ ì•„ë‹Œ ì‹œê°„ì…ë‹ˆë‹¤. ì²œì²œíˆ ë‹¬ë¦¬ì„¸ìš”'
        },
        {
          type: 'Recovery Run',
          distance: '4',
          duration: '25ë¶„',
          pace: '6:15 /km',
          description: 'ë§¤ìš° ê°€ë³ê²Œ ë‹¬ë¦¬ê¸°',
          tips: 'í”¼ë¡œ íšŒë³µì´ ëª©ì ì…ë‹ˆë‹¤. ìµœëŒ€í•œ ì²œì²œíˆ!'
        }
      ];

      const changePeriod = (delta) => {
        const newPeriod = new Date(currentPeriod);
        if (viewMode === 'week') {
          newPeriod.setDate(newPeriod.getDate() + (delta * 7));
        } else {
          newPeriod.setMonth(newPeriod.getMonth() + delta);
        }
        if (newPeriod >= threeYearsAgo && newPeriod <= threeYearsLater) {
          setCurrentPeriod(newPeriod);
          setSelectedDay(0);
        }
      };

      const canGoPrev = () => {
        const testDate = new Date(currentPeriod);
        if (viewMode === 'week') testDate.setDate(testDate.getDate() - 7);
        else testDate.setMonth(testDate.getMonth() - 1);
        return testDate >= threeYearsAgo;
      };

      const canGoNext = () => {
        const testDate = new Date(currentPeriod);
        if (viewMode === 'week') testDate.setDate(testDate.getDate() + 7);
        else testDate.setMonth(testDate.getMonth() + 1);
        return testDate <= threeYearsLater;
      };

      const getPeriodTitle = () => {
        if (viewMode === 'week') {
          const weekStart = new Date(currentPeriod);
          weekStart.setDate(weekStart.getDate() - weekStart.getDay());
          const weekEnd = new Date(weekStart);
          weekEnd.setDate(weekEnd.getDate() + 6);
          return `${weekStart.getMonth() + 1}/${weekStart.getDate()} - ${weekEnd.getMonth() + 1}/${weekEnd.getDate()}`;
        } else {
          return `${currentPeriod.getFullYear()}ë…„ ${currentPeriod.getMonth() + 1}ì›”`;
        }
      };

      const getDaysToShow = () => {
        if (viewMode === 'week') {
          const result = [];
          const start = new Date(currentPeriod);
          start.setDate(start.getDate() - start.getDay());
          for (let i = 0; i < 7; i++) {
            const date = new Date(start);
            date.setDate(date.getDate() + i);
            result.push(date);
          }
          return result;
        } else {
          const year = currentPeriod.getFullYear();
          const month = currentPeriod.getMonth();
          const firstDay = new Date(year, month, 1);
          const lastDay = new Date(year, month + 1, 0);
          const result = [];
          for (let i = 0; i < firstDay.getDay(); i++) result.push(null);
          for (let i = 1; i <= lastDay.getDate(); i++) result.push(new Date(year, month, i));
          return result;
        }
      };

      const getDayLabel = (date) => {
        if (!date) return '';
        const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        return days[date.getDay()];
      };

      const getDateLabel = (date) => !date ? '' : date.getDate();
      const getDateString = (date) => !date ? '' : date.toISOString().split('T')[0];

      const isCompleted = (date) => {
        if (!date) return false;
        const dateStr = getDateString(date);
        return workouts.some(log => log.date === dateStr);
      };

      const isToday = (date) => {
        if (!date) return false;
        const todayStr = new Date().toISOString().split('T')[0];
        return getDateString(date) === todayStr;
      };

      const daysToShow = getDaysToShow();
      const selectedDate = daysToShow[selectedDay];
      const todayWorkout = recommendedWorkouts[selectedDay % recommendedWorkouts.length];

      const isWorkoutInputComplete = () => workoutInput.distance && workoutInput.time;

      const completeWorkout = () => {
        if (!isWorkoutInputComplete()) {
          alert('ê±°ë¦¬ì™€ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
          return;
        }
        if (!selectedDate) {
          alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
          return;
        }

        const dateStr = getDateString(selectedDate);
        const newLog = {
          id: Date.now(),
          workout: todayWorkout,
          ...workoutInput,
          date: dateStr,
          achievement: Math.round((parseFloat(workoutInput.distance) / parseFloat(todayWorkout.distance)) * 100)
        };

        const updatedLogs = workouts.filter(log => log.date !== dateStr);
        updatedLogs.unshift(newLog);
        updatedLogs.sort((a, b) => new Date(b.date) - new Date(a.date));

        setWorkouts(updatedLogs);
        setStorage(`workouts_${userId}`, updatedLogs);
        setOriginalWorkoutInput({...workoutInput});
        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
      };

      React.useEffect(() => {
        if (selectedDate) {
          const dateStr = getDateString(selectedDate);
          const existingLog = workouts.find(log => log.date === dateStr);
          if (existingLog) {
            setWorkoutInput({
              time: existingLog.time,
              distance: existingLog.distance,
              avgHr: existingLog.avgHr || '',
              avgCadence: existingLog.avgCadence || '',
              rpe: existingLog.rpe || 5
            });
            setOriginalWorkoutInput({
              time: existingLog.time,
              distance: existingLog.distance,
              avgHr: existingLog.avgHr || '',
              avgCadence: existingLog.avgCadence || '',
              rpe: existingLog.rpe || 5
            });
          } else {
            setWorkoutInput({ time: '', distance: '', avgHr: '', avgCadence: '', rpe: 5 });
            setOriginalWorkoutInput(null);
          }
        }
      }, [selectedDay, workouts, viewMode, currentPeriod]);

      const isSaved = () => originalWorkoutInput !== null;
      const isWorkoutInputModified = () => {
        if (!originalWorkoutInput) return false;
        return JSON.stringify(workoutInput) !== JSON.stringify(originalWorkoutInput);
      };

      return (
        <>
          <div className="section">
            <h2 className="section-title">ğŸ“… í›ˆë ¨ ì¼ì</h2>
            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '16px', padding: '12px', background: '#f7fafc', borderRadius: '8px'}}>
              <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
                <button style={{width: '32px', height: '32px', border: 'none', background: 'white', borderRadius: '6px', cursor: 'pointer', fontSize: '16px'}} onClick={() => changePeriod(-1)} disabled={!canGoPrev()}>â—€</button>
                <div style={{fontSize: '16px', fontWeight: '600', minWidth: '120px', textAlign: 'center'}}>{getPeriodTitle()}</div>
                <button style={{width: '32px', height: '32px', border: 'none', background: 'white', borderRadius: '6px', cursor: 'pointer', fontSize: '16px'}} onClick={() => changePeriod(1)} disabled={!canGoNext()}>â–¶</button>
              </div>
              <div style={{display: 'flex', gap: '8px'}}>
                <button style={{padding: '6px 12px', border: viewMode === 'week' ? 'none' : '1px solid #e2e8f0', background: viewMode === 'week' ? '#667eea' : 'white', borderRadius: '6px', cursor: 'pointer', fontSize: '13px', color: viewMode === 'week' ? 'white' : '#4a5568'}} onClick={() => { setViewMode('week'); setCurrentPeriod(new Date()); setSelectedDay(0); }}>ì£¼</button>
                <button style={{padding: '6px 12px', border: viewMode === 'month' ? 'none' : '1px solid #e2e8f0', background: viewMode === 'month' ? '#667eea' : 'white', borderRadius: '6px', cursor: 'pointer', fontSize: '13px', color: viewMode === 'month' ? 'white' : '#4a5568'}} onClick={() => { setViewMode('month'); setCurrentPeriod(new Date()); setSelectedDay(0); }}>ì›”</button>
              </div>
            </div>
            <p style={{fontSize: '13px', color: '#718096', marginBottom: '16px'}}>ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ì¼ì˜ ì¶”ì²œ í›ˆë ¨ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
            <div style={{display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '8px', marginBottom: '20px'}}>
              {daysToShow.map((date, i) => {
                if (!date) return <div key={i} style={{visibility: 'hidden'}}></div>;
                return (
                  <div key={i} onClick={() => setSelectedDay(i)} style={{textAlign: 'center', padding: '12px 4px', borderRadius: '8px', background: isToday(date) ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : isCompleted(date) ? '#48bb78' : '#f7fafc', color: isToday(date) || isCompleted(date) ? 'white' : '#1a202c', cursor: 'pointer', border: selectedDay === i ? '2px solid #667eea' : '2px solid transparent', fontWeight: isToday(date) ? '600' : 'normal'}}>
                    <div style={{fontSize: '10px', marginBottom: '4px'}}>{getDayLabel(date)}</div>
                    <div style={{fontSize: '14px', fontWeight: '600'}}>{getDateLabel(date)}</div>
                  </div>
                );
              })}
            </div>
          </div>

          <div className="section">
            <h2 className="section-title">ğŸ¯ {selectedDate ? `${selectedDate.getMonth() + 1}/${selectedDate.getDate()}` : ''}ì˜ ì¶”ì²œ í›ˆë ¨</h2>
            {todayWorkout && (
              <div style={{background: 'linear-gradient(135deg, #f6f8fb 0%, #eef2f7 100%)', borderRadius: '12px', padding: '20px', marginTop: '16px', borderLeft: '4px solid #667eea'}}>
                <div style={{fontSize: '18px', fontWeight: '700', color: '#2d3748', marginBottom: '12px'}}>{todayWorkout.type}</div>
                <div style={{marginBottom: '16px'}}>
                  <div style={{display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '12px'}}>
                    <div style={{textAlign: 'center'}}>
                      <div style={{fontSize: '12px', color: '#718096'}}>ê±°ë¦¬</div>
                      <div style={{fontSize: '16px', fontWeight: '600', color: '#2d3748'}}>{todayWorkout.distance}km</div>
                    </div>
                    <div style={{textAlign: 'center'}}>
                      <div style={{fontSize: '12px', color: '#718096'}}>ì‹œê°„</div>
                      <div style={{fontSize: '16px', fontWeight: '600', color: '#2d3748'}}>{todayWorkout.duration}</div>
                    </div>
                    <div style={{textAlign: 'center'}}>
                      <div style={{fontSize: '12px', color: '#718096'}}>í˜ì´ìŠ¤</div>
                      <div style={{fontSize: '16px', fontWeight: '600', color: '#2d3748'}}>{todayWorkout.pace}</div>
                    </div>
                  </div>
                </div>
                <div style={{marginBottom: '8px'}}>
                  <div style={{fontSize: '14px', fontWeight: '600', color: '#4a5568', marginBottom: '8px'}}>ğŸ“ í›ˆë ¨ ì„¤ëª…</div>
                  <p style={{fontSize: '13px', lineHeight: '1.6', color: '#718096'}}>{todayWorkout.description}</p>
                </div>
                <div>
                  <div style={{fontSize: '14px', fontWeight: '600', color: '#4a5568', marginBottom: '8px'}}>ğŸ’¡ ìš´ë™ íŒ</div>
                  <p style={{fontSize: '13px', lineHeight: '1.6', color: '#718096'}}>{todayWorkout.tips}</p>
                </div>
              </div>
            )}
          </div>

          {selectedDate && (
            <div className="section">
              <h2 className="section-title">ğŸ“Š ìˆ˜í–‰ ì •ë³´ ì…ë ¥</h2>
              <div className="form-row">
                <div className="form-group">
                  <label className="form-label">ê±°ë¦¬ (km)</label>
                  <input type="number" step="0.1" className="form-input" placeholder="5.0" value={workoutInput.distance} onChange={(e) => setWorkoutInput({...workoutInput, distance: e.target.value})} />
                </div>
                <div className="form-group">
                  <label className="form-label">ì‹œê°„ (ë¶„)</label>
                  <input type="number" className="form-input" placeholder="30" value={workoutInput.time} onChange={(e) => setWorkoutInput({...workoutInput, time: e.target.value})} />
                </div>
              </div>
              <div className="form-row">
                <div className="form-group">
                  <label className="form-label">í‰ê·  ì‹¬ë°•ìˆ˜ (ì„ íƒ)</label>
                  <input type="number" className="form-input" placeholder="145" value={workoutInput.avgHr} onChange={(e) => setWorkoutInput({...workoutInput, avgHr: e.target.value})} />
                </div>
                <div className="form-group">
                  <label className="form-label">í‰ê·  ì¼€ì´ë˜ìŠ¤ (ì„ íƒ)</label>
                  <input type="number" className="form-input" placeholder="170" value={workoutInput.avgCadence} onChange={(e) => setWorkoutInput({...workoutInput, avgCadence: e.target.value})} />
                </div>
              </div>
              <div className="form-group">
                <label className="form-label">ì²´ê° ë‚œì´ë„ (RPE 1-10)</label>
                <input type="range" min="1" max="10" className="form-input" value={workoutInput.rpe || 5} onChange={(e) => setWorkoutInput({...workoutInput, rpe: e.target.value})} style={{padding: '0'}} />
                <div style={{textAlign: 'center', fontSize: '18px', fontWeight: '600', color: '#667eea'}}>{workoutInput.rpe || 5} / 10</div>
              </div>
              {!isSaved() ? (
                <button className="btn btn-primary" onClick={completeWorkout} disabled={!isWorkoutInputComplete()}>í›ˆë ¨ ì™„ë£Œ (ì €ì¥) ğŸ‰</button>
              ) : (
                <button className="btn" style={{background: '#ed8936', color: 'white', width: '100%'}} onClick={completeWorkout} disabled={!isWorkoutInputModified()}>í›ˆë ¨ ì™„ë£Œ (ìˆ˜ì •) âœï¸</button>
              )}
            </div>
          )}
        </>
      );
    }

    function CommunityPage({ userId }) {
      const workouts = getStorage(`workouts_${userId}`, []);

      if (workouts.length === 0) {
        return (
          <div className="empty-state">
            <div className="empty-icon">ğŸƒ</div>
            <p>ì•„ì§ ê¸°ë¡ëœ í›ˆë ¨ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            <p style={{fontSize: '14px', marginTop: '8px'}}>í›ˆë ¨ì„ ì™„ë£Œí•˜ë©´ ìë™ìœ¼ë¡œ í”¼ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤!</p>
          </div>
        );
      }

      const totalDistance = workouts.reduce((sum, w) => sum + parseFloat(w.distance || 0), 0);
      const totalTime = workouts.reduce((sum, w) => sum + parseFloat(w.time || 0), 0);

      return (
        <>
          <div className="section">
            <h2 className="section-title">ğŸ“Š ë‚˜ì˜ í†µê³„</h2>
            <div className="stat-grid">
              <div className="stat-card">
                <div className="stat-value">{workouts.length}</div>
                <div className="stat-label">ì´ í›ˆë ¨</div>
              </div>
              <div className="stat-card">
                <div className="stat-value">{totalDistance.toFixed(1)}</div>
                <div className="stat-label">ì´ ê±°ë¦¬ (km)</div>
              </div>
              <div className="stat-card">
                <div className="stat-value">{totalTime.toFixed(0)}</div>
                <div className="stat-label">ì´ ì‹œê°„ (ë¶„)</div>
              </div>
              <div className="stat-card">
                <div className="stat-value">{(totalTime / totalDistance).toFixed(2)}</div>
                <div className="stat-label">í‰ê·  í˜ì´ìŠ¤ (ë¶„/km)</div>
              </div>
            </div>
          </div>

          <div className="section">
            <h2 className="section-title">ğŸŒŸ í›ˆë ¨ í”¼ë“œ</h2>
            {workouts.map(w => {
              const date = new Date(w.date);
              const timeAgo = Math.floor((Date.now() - date.getTime()) / (1000 * 60 * 60 * 24));
              const timeLabel = timeAgo === 0 ? 'ì˜¤ëŠ˜' : timeAgo === 1 ? 'ì–´ì œ' : `${timeAgo}ì¼ ì „`;

              return (
                <div key={w.id} className="feed-card">
                  <div className="feed-header">
                    <div className="feed-avatar">R</div>
                    <div className="feed-user-info">
                      <div className="feed-username">Runner</div>
                      <div className="feed-time">{timeLabel}</div>
                    </div>
                  </div>
                  <div className="feed-image">
                    <div className="feed-stat">{w.distance}km</div>
                    <div className="feed-stat-label">{w.time}ë¶„ ëŸ¬ë‹ ì™„ë£Œ</div>
                  </div>
                  <div className="feed-content">
                    ëŸ¬ë‹ ì™„ë£Œ! ğŸƒâ€â™‚ï¸ {w.distance}kmë¥¼ {w.time}ë¶„ ë™ì•ˆ ë‹¬ë ¸ìŠµë‹ˆë‹¤.
                    <br/>í‰ê·  í˜ì´ìŠ¤: {(parseFloat(w.time) / parseFloat(w.distance)).toFixed(2)}ë¶„/km
                  </div>
                  <div>
                    <span className="tag">#ëŸ¬ë‹</span>
                    <span className="tag">#RunWithAI</span>
                    <span className="tag">#ìš´ë™ì™„ë£Œ</span>
                  </div>
                  <div className="feed-stats">
                    <div>â¤ï¸ {Math.floor(Math.random() * 20) + 5}</div>
                    <div>ğŸ’¬ {Math.floor(Math.random() * 10)}</div>
                  </div>
                </div>
              );
            })}
          </div>
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
